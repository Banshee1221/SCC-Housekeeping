---
- name: Copy local libselinux-python to compute nodes
  copy: src="libselinux-python-2.2.2-6.el7.x86_64.rpm" dest="/tmp/libselinux-python-2.2.2-6.el7.x86_64.rpm"

- name: Install it, just in case :p
  yum: name=/tmp/libselinux-python-2.2.2-6.el7.x86_64.rpm state=present

- name: Copy the headnode's hosts file to the compute nodes
  copy: src=/etc/hosts dest=/etc/hosts backup=yes

- name: Remove existing entries from compute nodes /etc/resolv.conf
  shell: printf "" > /etc/resolv.conf

- name: Set the nameserver of the compute nodes to the IP of the headnode
  lineinfile: dest=/etc/resolv.conf line="nameserver {{ item }}"
  with_items: "{{ compute_nameservers }}"

- name: Set the /etc/resolv.conf file of the compute nodes as immutable
  shell: chattr +i /etc/resolv.conf
